<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Reproducible Research with Make</title>
  <meta name="description" content="        Reproducible Research with Make    Reproducibility with Make Prerequisites / recommended skill level PrerequisiteImportanceNotesExperience with the c...">

  <link rel="canonical" href="https://the-turing-way.netlify.com//es/make/make.html">
  <link rel="alternate" type="application/rss+xml" title="The Turing Way" href="https://the-turing-way.netlify.com//feed.xml">

  <meta property="og:url"         content="https://the-turing-way.netlify.com//es/make/make.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Reproducible Research with Make" />
<meta property="og:description" content="        Reproducible Research with Make    Reproducibility with Make Prerequisites / recommended skill level PrerequisiteImportanceNotesExperience with the c..." />
<meta property="og:image"       content="https://the-turing-way.netlify.com/" />

<meta name="twitter:card" content="summary">


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": "https://the-turing-way.netlify.com//es/make/make.html",
  "headline": "Reproducible Research with Make",
  "datePublished": "2022-03-30T16:46:28+01:00",
  "dateModified": "2022-03-30T16:46:28+01:00",
  "description": "        Reproducible Research with Make    Reproducibility with Make Prerequisites / recommended skill level PrerequisiteImportanceNotesExperience with the c...",
  "author": {
    "@type": "Person",
    "name": "Kirstie Whitaker"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "https://the-turing-way.netlify.com/",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "https://the-turing-way.netlify.com/",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/assets/css/styles.css">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<!-- (mostly) copied from nbconvert configuration -->
<!-- https://github.com/jupyter/nbconvert/blob/master/nbconvert/templates/html/mathjax.tpl -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    // Center justify equations in code and markdown cells. Elsewhere
    // we use CSS to left justify single line equations in code cells.
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        linebreaks: { automatic: true },
    },
    
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML' async></script>


  <!-- DOM updating function -->
  <script src="/assets/js/page/dom-update.js"></script>

  <!-- Selectors for elements on the page -->
  <script src="/assets/js/page/documentSelectors.js"></script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js" async></script>
  <script src="/assets/js/page/anchors.js" async></script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turbolinks/5.2.0/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->


<!-- Display Thebelab button in each code cell -->
<script>
/**
 * Set up thebelab button for code blocks
 */

const thebelabCellButton = id =>
  `<a id="thebelab-cell-button-${id}" class="btn thebebtn o-tooltip--left" data-tooltip="Interactive Mode">
    <img src="/assets/images/edit-button.svg" alt="Start thebelab interactive mode">
  </a>`


const addThebelabButtonToCodeCells =  () => {

  const codeCells = document.querySelectorAll('div.input_area > div.highlight:not(.output) pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.getElementById("thebelab-cell-button-" + id) == null) {
      codeCell.insertAdjacentHTML('afterend', thebelabCellButton(id));
    }
  })
}

initFunction(addThebelabButtonToCodeCells);
</script>


<script src="https://unpkg.com/thebelab@latest/lib/index.js" async></script>
<script>
    /**
     * Add attributes to Thebelab blocks
     */

    const initThebelab = () => {
        const addThebelabToCodeCells = () => {
            console.log("Adding thebelab to code cells...");
            // If Thebelab hasn't loaded, wait a bit and try again. This
            // happens because we load ClipboardJS asynchronously.
            if (window.thebelab === undefined) {
                setTimeout(addThebelabToCodeCells, 250)
            return
            }

            // If we already detect a Thebelab cell, don't re-run
            if (document.querySelectorAll('div.thebelab-cell').length > 0) {
                return;
            }

            // Find all code cells, replace with Thebelab interactive code cells
            const codeCells = document.querySelectorAll('.input_area pre')
            codeCells.forEach((codeCell, index) => {
                const id = codeCellId(index)

                // Clean up the language to make it work w/ CodeMirror and add it to the cell
                dataLanguage = ""
                dataLanguage = detectLanguage(dataLanguage);
                codeCell.setAttribute('data-language', dataLanguage)
                codeCell.setAttribute('data-executable', 'true')

                // If the code cell is hidden, show it
                var inputCheckbox = document.querySelector(`input#hidebtn${codeCell.id}`);
                if (inputCheckbox !== null) {
                    setCodeCellVisibility(inputCheckbox, 'visible');
                }
            });

            // Remove the event listener from the page so keyboard press doesn't
            // Change page
            document.removeEventListener('keydown', initPageNav)
            keyboardListener = false;

            // Init thebelab
            thebelab.bootstrap();

            // Remove copy buttons since they won't work anymore
            const copyAndThebeButtons = document.querySelectorAll('.copybtn, .thebebtn')
            copyAndThebeButtons.forEach((button, index) => {
                button.remove();
            });

            // Remove outputs since they'll be stale
            const outputs = document.querySelectorAll('.output *, .output')
            outputs.forEach((output, index) => {
                output.remove();
            });

            // Find any cells with an initialization tag and ask ThebeLab to run them when ready
            var thebeInitCells = document.querySelectorAll('div.tag_thebelab-init');
            thebeInitCells.forEach((cell) => {
                console.log("Initializing ThebeLab with cell: " + cell.id);
                cell.querySelector('.thebelab-run-button').click();
            });
        }

        // Add event listener for the function to modify code cells
        const thebelabButtons = document.querySelectorAll('[id^=thebelab], [id$=thebelab]')
        thebelabButtons.forEach((thebelabButton,index) => {
            if (thebelabButton === null) {
                setTimeout(initThebelab, 250)
                return
            };
            thebelabButton.addEventListener('click', addThebelabToCodeCells);
        });
    }

    // Initialize Thebelab
    initFunction(initThebelab);

// Helper function to munge the language name
var detectLanguage = (language) => {
    if (language.indexOf('python') > -1) {
        language = "python";
    }
    return language;
}
</script>



  <!-- Load the auto-generating TOC (non-async otherwise the TOC won't load w/ turbolinks) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.8.1/tocbot.min.js" async></script>
  <script src="/assets/js/page/tocbot.js"></script>

  <!-- Google analytics -->
  


  <!-- Clipboard copy button -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script>

  <!-- Load custom website scripts -->
  <script src="/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  

  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" async></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>

  <!-- Load JS that depends on site variables -->
  <script src="/assets/js/page/copy-button.js" async></script>

  <!-- Hide cell code -->
  <script src="/assets/js/page/hide-cell.js" async></script>

  <!-- Printing the screen -->
  <!-- Include nbinteract for interactive widgets -->
<script src="https://printjs-4de6.kxcdn.com/print.min.js" async></script>
<script>
printContent = () => {
    // MathJax displays a second version of any math for assistive devices etc.
    // This prevents double-rendering in the PDF output.
    var ignoreAssistList = [];
    assistives = document.querySelectorAll('.MathJax_Display span.MJX_Assistive_MathML').forEach((element, index) => {
        var thisId = 'MathJax-assistive-' + index.toString();
        element.setAttribute('id', thisId);
        ignoreAssistList.push(thisId)
    });

    // Print the actual content object
    printJS({
        printable: 'textbook_content',
        type: 'html',
        css: "/assets/css/styles.css",
        style: "#textbook_content {padding-top: 40px};",
        scanStyles: false,
        targetStyles: ["*"],
        ignoreElements: ignoreAssistList,
        documentTitle: "Made with Jupyter Book"
    })
};

initPrint = () => {
    document.querySelector('#interact-button-print').addEventListener('click', printContent)
}

initFunction(initPrint)
</script>

</head>

  <body>
    <!-- Include the ThebeLab config so it gets reloaded on each page -->
    <script type="text/x-thebe-config">{
    requestKernel: true,
    binderOptions: {
    repo: "alan-turing-institute/the-turing-way-book",
    ref: "master",
    },
    codeMirrorConfig: {
    theme: "abcdef",
    mode: "python"
    },
    kernelOptions: {
    kernelName: "python3",
    path: ""
    }
}
</script>

    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://github.com/alan-turing-institute/the-turing-way/"><img src="" class="textbook_logo" id="sidebar-logo" alt="textbook logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">The Turing Way</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/introduction/introduction">
        <a class="c-sidebar__entry"
          href="/es/introduction/introduction.html"
        >
          
            1.
          
          Introduction
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/reproducibility/reproducibility">
        <a class="c-sidebar__entry"
          href="/es/reproducibility/reproducibility.html"
        >
          
            2.
          
          Reproducibility
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections u-hidden-visually">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducibility/01/importantforscience">
              <a class="c-sidebar__entry"
                href="/es/reproducibility/01/importantforscience.html"
              >
                
                  2.1
                
                Why reproducibility is important
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducibility/02/whycare">
              <a class="c-sidebar__entry"
                href="/es/reproducibility/02/whycare.html"
              >
                
                  2.2
                
                Why you should care
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducibility/03/definitions">
              <a class="c-sidebar__entry"
                href="/es/reproducibility/03/definitions.html"
              >
                
                  2.3
                
                Definitions
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducibility/04/resources">
              <a class="c-sidebar__entry"
                href="/es/reproducibility/04/resources.html"
              >
                
                  2.4
                
                Resources
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/open_research/open_research">
        <a class="c-sidebar__entry"
          href="/es/open_research/open_research.html"
        >
          
            3.
          
          Open Research
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections u-hidden-visually">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/open_research/01/opendata">
              <a class="c-sidebar__entry"
                href="/es/open_research/01/opendata.html"
              >
                
                  3.1
                
                Open data
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/open_research/02/opensourcesoftware">
              <a class="c-sidebar__entry"
                href="/es/open_research/02/opensourcesoftware.html"
              >
                
                  3.2
                
                Open source software
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/open_research/03/openhardware">
              <a class="c-sidebar__entry"
                href="/es/open_research/03/openhardware.html"
              >
                
                  3.3
                
                Open hardware
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/open_research/04/openaccess">
              <a class="c-sidebar__entry"
                href="/es/open_research/04/openaccess.html"
              >
                
                  3.4
                
                Open access
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/open_research/05/opennotebooks">
              <a class="c-sidebar__entry"
                href="/es/open_research/05/opennotebooks.html"
              >
                
                  3.5
                
                Open notebooks
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/open_research/06/openscholarship">
              <a class="c-sidebar__entry"
                href="/es/open_research/06/openscholarship.html"
              >
                
                  3.6
                
                Open scholarship
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/open_research/07/resources">
              <a class="c-sidebar__entry"
                href="/es/open_research/07/resources.html"
              >
                
                  3.7
                
                Resources
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/version_control/version_control">
        <a class="c-sidebar__entry"
          href="/es/version_control/version_control.html"
        >
          
            4.
          
          Version Control
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/collaborating_github/collaborating_github">
        <a class="c-sidebar__entry"
          href="/es/collaborating_github/collaborating_github.html"
        >
          
            5.
          
          Collaborating on GitHub/GitLab
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections u-hidden-visually">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/collaborating_github/1/readme_communication">
              <a class="c-sidebar__entry"
                href="/es/collaborating_github/1/readme_communication.html"
              >
                
                  5.1
                
                README and Project Communication
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/collaborating_github/2/roadmapping">
              <a class="c-sidebar__entry"
                href="/es/collaborating_github/2/roadmapping.html"
              >
                
                  5.2
                
                Roadmapping
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/collaborating_github/3/getting_contributors">
              <a class="c-sidebar__entry"
                href="/es/collaborating_github/3/getting_contributors.html"
              >
                
                  5.3
                
                Getting Contributors
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/collaborating_github/4/checklist_bibliography">
              <a class="c-sidebar__entry"
                href="/es/collaborating_github/4/checklist_bibliography.html"
              >
                
                  5.4
                
                Checklist and Bibliography
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/credit/credit">
        <a class="c-sidebar__entry"
          href="/es/credit/credit.html"
        >
          
            6.
          
          Credit for reproducible research
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/rdm/rdm">
        <a class="c-sidebar__entry"
          href="/es/rdm/rdm.html"
        >
          
            7.
          
          Research Data Management
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/reproducible_environments/reproducible_environments">
        <a class="c-sidebar__entry"
          href="/es/reproducible_environments/reproducible_environments.html"
        >
          
            8.
          
          Reproducible Environments
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections u-hidden-visually">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/01/options">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/01/options.html"
              >
                
                  8.1
                
                Choosing a tool
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/02/package-management">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/02/package-management.html"
              >
                
                  8.2
                
                Conda
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/03/yaml">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/03/yaml.html"
              >
                
                  8.3
                
                YAML
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/04/binder">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/04/binder.html"
              >
                
                  8.4
                
                Binder
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/05/virtual-machines">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/05/virtual-machines.html"
              >
                
                  8.5
                
                Virtual machines
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/06/containers">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/06/containers.html"
              >
                
                  8.6
                
                Containers
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/07/checklist">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/07/checklist.html"
              >
                
                  8.7
                
                Checklist
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reproducible_environments/08/resources">
              <a class="c-sidebar__entry"
                href="/es/reproducible_environments/08/resources.html"
              >
                
                  8.8
                
                Resources
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/testing/testing">
        <a class="c-sidebar__entry"
          href="/es/testing/testing.html"
        >
          
            9.
          
          Testing
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/reviewing/reviewing">
        <a class="c-sidebar__entry"
          href="/es/reviewing/reviewing.html"
        >
          
            10.
          
          Reviewing
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections u-hidden-visually">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reviewing/01/how_helpful">
              <a class="c-sidebar__entry"
                href="/es/reviewing/01/how_helpful.html"
              >
                
                  10.1
                
                How this will help you and why this is useful
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reviewing/02/best_practice">
              <a class="c-sidebar__entry"
                href="/es/reviewing/02/best_practice.html"
              >
                
                  10.2
                
                Best Practice
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reviewing/03/typical_workflows">
              <a class="c-sidebar__entry"
                href="/es/reviewing/03/typical_workflows.html"
              >
                
                  10.3
                
                Typical Workflows
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/reviewing/04/checklists_bib">
              <a class="c-sidebar__entry"
                href="/es/reviewing/04/checklists_bib.html"
              >
                
                  10.4
                
                Checklists, what to learn next and bibliography
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/continuous_integration/continuous_integration">
        <a class="c-sidebar__entry"
          href="/es/continuous_integration/continuous_integration.html"
        >
          
            11.
          
          Continuous Integration
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/make/make">
        <a class="c-sidebar__entry"
          href="/es/make/make.html"
        >
          
            12.
          
          Reproducible Research with Make
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/risk_assessment/risk_assessment">
        <a class="c-sidebar__entry"
          href="/es/risk_assessment/risk_assessment.html"
        >
          
            13.
          
          Risk Assessment
        </a>
      </li>

      
      

      

      
      

      
        

        

        <ul class="c-sidebar__sections u-hidden-visually">
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/risk_assessment/01/longreadriskassessment">
              <a class="c-sidebar__entry"
                href="/es/risk_assessment/01/longreadriskassessment.html"
              >
                
                  13.1
                
                Long Read on Risk Assessment
              </a>
            </li>
            
            
          
            
            

            
            
            
            

            <li class="c-sidebar__section" data-url="/es/risk_assessment/02/finalsummary">
              <a class="c-sidebar__entry"
                href="/es/risk_assessment/02/finalsummary.html"
              >
                
                  13.2
                
                Summary
              </a>
            </li>
            
            
          
        </ul>
      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/binderhub/binderhub">
        <a class="c-sidebar__entry"
          href="/es/binderhub/binderhub.html"
        >
          
            14.
          
          BinderHub
        </a>
      </li>

      
      

      

      
      

      

      
    
      
      

      
      
      
      

      
      
      <li class="c-sidebar__chapter" data-url="/es/glossary/glossary">
        <a class="c-sidebar__entry"
          href="/es/glossary/glossary.html"
        >
          
            15.
          
          Glossary
        </a>
      </li>

      
      

      

      
      

      

      
    
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://github.com/jupyter/jupyter-book">Jupyter Book</a></p>
</nav>

      
      <div class="c-topbar" id="top-navbar">
  <!-- We show the sidebar by default so we use .is-active -->
  <div class="c-topbar__buttons">
    <button
      id="js-sidebar-toggle"
      class="hamburger hamburger--arrowalt is-active"
    >
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="buttons">
<div class="download-buttons-dropdown">
    <button id="dropdown-button-trigger" class="interact-button"><img src="/assets/images/download-solid.svg" alt="Download" /></button>
    <div class="download-buttons">
        
        <a id="interact-button-print"><button id="interact-button-download" class="interact-button">.pdf</button></a>
    </div>
</div>


</div>

  </div>
  <!-- Empty sidebar placeholder that we'll auto-fill with javascript -->
  <aside class="sidebar__right">
    <header><h4 class="nav__title"><img src="/assets/images/list-solid.svg" alt="Search" />   On this page</h4></header>
    <nav class="onthispage">
    </nav>
  </aside>
  <a href="/search.html" class="topbar-right-button" id="search-button">
    <img src="/assets/images/search-solid.svg" alt="Search" />
  </a>
</div>

      <main class="c-textbook__page" tabindex="-1">
            <div class="c-textbook__content" id="textbook_content">
                  <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Reproducible Research with Make</div>
</div>
    
<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Reproducibility-with-Make">Reproducibility with Make<a class="anchor-link" href="#Reproducibility-with-Make"> </a></h1><h2 id="Prerequisites-/-recommended-skill-level">Prerequisites / recommended skill level<a class="anchor-link" href="#Prerequisites-/-recommended-skill-level"> </a></h2><table>
<thead><tr>
<th>Prerequisite</th>
<th>Importance</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://programminghistorian.org/en/lessons/intro-to-bash">Experience with the command line</a></td>
<td>Necessary</td>
<td></td>
</tr>
<tr>
<td><a href="/version_control/version_control">Version control</a></td>
<td>Helpful</td>
<td>Experience using git is useful to follow along with examples</td>
</tr>
</tbody>
</table>
<p>Recommended skill level: intermediate</p>
<h2 id="Table-of-contents">Table of contents<a class="anchor-link" href="#Table-of-contents"> </a></h2><ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#an-introduction-to-make">An Introduction to Make</a><ul>
<li><a href="#what-is-make">What is Make</a></li>
<li><a href="#why-use-make-for-reproducible-research">Why use Make for Reproducible Research?</a></li>
</ul>
</li>
<li><a href="#learn-make-by-example">Learn Make by Example</a><ul>
<li><a href="#setting-up">Setting up</a></li>
<li><a href="#makefile-no-1-the-basics">Makefile no. 1 (The Basics)</a></li>
<li><a href="#makefile-no-2-all-and-clean">Makefile no. 2 (all and clean)</a></li>
<li><a href="#makefile-no-3-phony-targets">Makefile no. 3 (Phony Targets)</a></li>
<li><a href="#makefile-no-4-automatic-variables-and-pattern-rules">Makefile no. 4 (Automatic Variables and Pattern Rules)</a></li>
<li><a href="#makefile-no-5-wildcards-and-path-substitution">Makefile no. 5 (Wildcards and Path Substitution)</a></li>
<li><a href="#debugging-makefiles">Debugging Makefiles</a></li>
</ul>
</li>
<li><a href="#a-real-reproducible-paper-using-make">A Real Reproducible Paper using Make</a></li>
<li><a href="#further-reading">Further Reading</a><ul>
<li><a href="#manual">Manual</a></li>
<li><a href="#discussions">Discussions</a></li>
<li><a href="#blogs">Blogs</a></li>
<li><a href="#tools">Tools</a></li>
<li><a href="#alternatives-to-make">Alternatives to Make</a></li>
</ul>
</li>
<li><a href="#glossary">Glossary</a></li>
<li><a href="#appendix">Appendix</a><ul>
<li><a href="#directed-acyclic-graph">Directed Acyclic Graph</a></li>
<li><a href="#installing-make">Installing Make</a></li>
<li><a href="#advanced-generating-rules-using-call">Advanced: Generating Rules using Call</a></li>
</ul>
</li>
</ul>
<h2 id="Summary">Summary<a class="anchor-link" href="#Summary"> </a></h2><p>A data science or research project can be seen as a tree of dependencies: the 
report depends on the figures and tables, and these in turn depend on the data 
and the analysis scripts used to process this data (illustrated in the figure 
below).  Make is a tool for creating output files from their dependencies 
through pre-specified rules.  It is possible to combine these two ideas to 
create a reproducible project with Make.  In this chapter we give an 
introduction to Make and provide a tutorial on how Make can be used for a data 
analysis pipeline.  We also describe a real-world reproducible research 
project that uses Make to go from the raw input data to the experiments all 
the way to the pdf file of the paper!</p>
<p><img src="../../figures/make/research_dag.png" alt="Schematic of a research project">
<small style="margin: 5pt auto; text-align: center; display: block;">A 
schematic for a research project that uses LaTeX.</small></p>
<h2 id="An-Introduction-to-Make">An Introduction to Make<a class="anchor-link" href="#An-Introduction-to-Make"> </a></h2><h3 id="What-is-Make">What is Make<a class="anchor-link" href="#What-is-Make"> </a></h3><p>Make is a build automation tool. It uses a configuration file called a 
Makefile that contains the <em>rules</em> for what to build. Make builds <em>targets</em> 
using <em>recipes</em>.  Targets can optionally have <em>prerequisites</em>.  Prerequisites 
can be files on your computer or other targets. Make determines what to build 
based on the dependency tree of the targets and prerequisites (technically, 
this is a <a href="#directed-acyclic-graph">directed acyclic graph</a>).  It uses the 
<em>modification time</em> of prerequisites to update targets only when needed.</p>
<h3 id="Why-use-Make-for-Reproducibility?">Why use Make for Reproducibility?<a class="anchor-link" href="#Why-use-Make-for-Reproducibility?"> </a></h3><p>There are several reasons why Make is a good tool to use for reproducibility:</p>
<ol>
<li>Make is easy to learn</li>
<li>Make is available on many platforms</li>
<li>Many people are already familiar with Make</li>
<li>Makefiles reduce cognitive load because as long as the common Make targets 
<code>all</code> and <code>clean</code> are present (explained below), you can be up and 
running without having to read lengthy instructions. This is especially 
useful when you work on someone else's project or on one that you haven't 
used in a long time.</li>
<li>Makefiles are human-readable and machine-readable text files. So instead of 
writing instructions to a human for how to build a report or output, you 
can provide a Makefile with instructions that can be read by a human <em>and</em> 
executed by a computer.</li>
<li>Because Makefiles are text files they are easy to share and keep in version 
control.</li>
<li>Using Make doesn't exclude using other tools such as Travis and Docker.</li>
</ol>
<h2 id="Learn-Make-by-Example">Learn Make by Example<a class="anchor-link" href="#Learn-Make-by-Example"> </a></h2><p>One of the things that might scare people off from using Make is that existing 
Makefiles can seem daunting and it may seem difficult to tailor to your own 
needs.  In this hands-on tutorial we will iteratively construct a Makefile for 
a real data analysis project. The idea is to explain different features of 
Make by iterating through several versions of a Makefile for this project. 
Hopefully the experience that you gain from this tutorial allows you to create 
Makefiles for your own projects.</p>
<p>We will create a <code>Makefile</code> for a data analysis pipeline. The task is as 
follows:</p>
<blockquote><p><strong>Task: Given some datasets, create a summary report (in pdf) that contains 
the histograms of these datasets.</strong></p>
</blockquote>
<p>(Of course this data task is very simple to focus on how to use Make.)</p>
<p><em>Throughout the tutorial code blocks that start with a dollar sign (<code>$</code>) are 
intended to be typed in the terminal.</em></p>
<h3 id="Setting-up">Setting up<a class="anchor-link" href="#Setting-up"> </a></h3><p>We have created a basic repository for this task, that already contains 
everything that we need (<em>except the Makefile of course!</em>). To start, clone 
the base repository using git:</p>
<div class="highlight"><pre><span></span>$ git clone https://github.com/alan-turing-institute/IntroToMake
</pre></div>
<p>This basic repository contains all the code that we'll need in this tutorial, 
and should have this content:</p>
<div class="highlight"><pre><span></span>.
├── data/
│   ├── input_file_1.csv
│   └── input_file_2.csv
├── LICENSE
├── output/
├── README.md
├── report/
│   └── report.tex
└── scripts/
    └── generate_histogram.py
</pre></div>
<ul>
<li><strong>data</strong>: directory with two datasets that we're going to analyse</li>
<li><strong>report</strong>: the input directory for the report</li>
<li><strong>scripts</strong>: directory for the analysis script</li>
<li><strong>output</strong>: output directory for the figures and the report</li>
</ul>
<p>You'll notice that there are two datasets in the <strong>data</strong> directory 
(<code>input_file_1.csv</code> and <code>input_file_2.csv</code>) and that there is already a 
basic Python script in <strong>scripts</strong> and a basic report LaTeX file in 
<strong>report</strong>.</p>
<p>If you want to follow along, ensure that you have the <code>matplotlib</code> and 
<code>numpy</code> packages installed:</p>
<div class="highlight"><pre><span></span>$ pip install matplotlib numpy
</pre></div>
<p>You will also need a working version of <code>pdflatex</code> and, of course, <code>make</code>. 
For installation instructions for Make, see <a href="#installing-make">the installation instructions 
below</a>.</p>
<h3 id="Makefile-no.-1-(The-Basics)">Makefile no. 1 (The Basics)<a class="anchor-link" href="#Makefile-no.-1-(The-Basics)"> </a></h3><p>Let's create our first Makefile. In the terminal, move into the 
<code>IntroToMake</code> repository that you just cloned:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> IntroToMake
</pre></div>
<p>Using your favourite editor, create a file called <code>Makefile</code> with the 
following contents:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i data/input_file_1.csv -o output/figure_1.png

<span class="nf">output/figure_2.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i data/input_file_2.csv -o output/figure_2.png

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../output/report.pdf
</pre></div>
<p>The indentation in each of the recipes are <strong><em>tabs</em></strong>, Makefiles do not accept 
indentation with spaces.</p>
<p>You should now be able to type:</p>
<div class="highlight"><pre><span></span>$ make output/report.pdf
</pre></div>
<p>If everything worked correctly, the two figures will be created and pdf report 
will be built.</p>
<p>Let's go through the Makefile in a bit more detail. We have three rules, two 
for the figures and one for the report. Let's look at the rule for 
<code>output/figure_1.png</code> first. This rule has the target 
<code>output/figure_1.png</code> that has two prerequisites: <code>data/input_file_1.csv</code> 
and <code>scripts/generate_histogram.py</code>. By giving the output file these 
prerequisites it will be updated if either of these files changes. This is one 
of the reasons why Make was created: to update output files when source files 
change.</p>
<p>You'll notice that the recipe line calls Python with the script name and uses 
command line flags (<code>-i</code> and <code>-o</code>) to mark the input and output of the 
script. This isn't a requirement for using Make, but it makes it easy to see 
which file is an input to the script and which is an output.</p>
<p>The rule for the PDF report is very similar, but it has three prerequisites 
(the LaTeX source and both figures). Notice that the recipe changes the 
working directory before calling LaTeX and also moves the generated PDF to the 
output directory. We're doing this to keep the LaTeX intermediate files in the 
report directory. However, it's important to distinguish the above rule from 
the following:</p>
<div class="highlight"><pre><span></span><span class="c"># don&#39;t do this</span>
<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
    <span class="nb">cd</span> report/
    pdflatex report.tex
    mv report.pdf ../output/report.pdf
</pre></div>
<p>This rule places the three commands on separate lines. However, <strong>Make 
executes each line independently</strong> in a separate subshell, so changing the 
working directory in the first line has no effect on the second, and a failure 
in the second line won't stop the third line from being executed. Therefore, 
we combine the three commands in a single recipe above.</p>
<p>This is what the dependency tree looks like for this Makefile:</p>
<p><img src="../../figures/make/makefile_no_1.png" alt="DAG for Makefile no. 1">
<small style="margin: 5pt auto; text-align: center; display: block;">The 
dependency graph for our first Makefile, created using 
[makefile2graph](#tools). Notice the similarity to the figure at the 
top!</small></p>
<h3 id="Makefile-no.-2-(all-and-clean)">Makefile no. 2 (all and clean)<a class="anchor-link" href="#Makefile-no.-2-(all-and-clean)"> </a></h3><p>In our first Makefile we have the basic rules in place. We could stick with 
this if we wanted to, but there are a few improvements we can make:</p>
<ol>
<li><p>We now have to explicitly call <code>make output/report.pdf</code> if we want to 
make the report.</p>
</li>
<li><p>We have no way to clean up and start fresh.</p>
</li>
</ol>
<p>Let's remedy this by adding two new targets: <code>all</code> and <code>clean</code>. In your 
editor, change the Makefile contents to add the <code>all</code> and <code>clean</code> rules as 
follows:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i data/input_file_1.csv -o output/figure_1.png

<span class="nf">output/figure_2.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i data/input_file_2.csv -o output/figure_2.png

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f output/figure_*.png
</pre></div>
<p>Note that we've added the <code>all</code> target to the top of the file. We do this 
because Make executes the <em>first</em> target when no explicit target is given.  So 
you can now type <code>make</code> on the command line and it would do the same as 
<code>make all</code>.  Also, note that we've only added the report as the prerequisite 
of <code>all</code> because that's our desired output and the other rules help to build 
that output. If you have multiple outputs, you could add these as further 
prerequisites to the <code>all</code> target. Calling the main target <code>all</code> is a 
convention of Makefiles that many people follow.</p>
<p>The <code>clean</code> rule is typically at the bottom, but that's more style than 
requirement. Note that we use the <code>-f</code> flag to <code>rm</code> to make sure it 
doesn't complain when there is no file to remove.</p>
<p>You can try out the new Makefile by running:</p>
<div class="highlight"><pre><span></span>$ make clean
$ make
</pre></div>
<p>Make should remove the output and intermediate files after the first command, 
and generate them again after the second.</p>
<h3 id="Makefile-no.-3-(Phony-Targets)">Makefile no. 3 (Phony Targets)<a class="anchor-link" href="#Makefile-no.-3-(Phony-Targets)"> </a></h3><p>Typically, <code>all</code> and <code>clean</code> are defined as so-called <a href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets">Phony 
Targets</a>. 
These are targets that don't actually create an output file. Such targets will 
always be run if they come up in a dependency, but will no longer be run if a 
directory/file is ever created that is called <code>all</code> or <code>clean</code>. We 
therefore add a line at the top of the Makefile to define these two as phony 
targets:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i data/input_file_1.csv -o output/figure_1.png

<span class="nf">output/figure_2.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i data/input_file_2.csv -o output/figure_2.png

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f output/figure_*.pdf
</pre></div>
<p>Phony targets are also useful when you want to use Make recursively. In that 
case you would specify the subdirectories as phony targets. You can read more 
about <a href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets">phony targets in the 
documentation</a>, 
but for now it's enough to know that <code>all</code> and <code>clean</code> are typically 
declared as phony.</p>
<blockquote><p>Sidenote: another target that's typically phony is <strong>test</strong>, in case you 
have a directory of tests called <strong>test</strong> and want to have a target to run 
them that's also called <strong>test</strong>.</p>
</blockquote>
<h3 id="Makefile-no.-4-(Automatic-Variables-and-Pattern-Rules)">Makefile no. 4 (Automatic Variables and Pattern Rules)<a class="anchor-link" href="#Makefile-no.-4-(Automatic-Variables-and-Pattern-Rules)"> </a></h3><p>There's nothing wrong with the Makefile we have now, but it's somewhat verbose 
because we've declared all the targets explicitly using separate rules. We can 
simplify this by using <a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">Automatic 
Variables</a> 
and <a href="https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html#Pattern-Rules">Pattern 
Rules</a>.</p>
<p><a name="automatic_var"></p>
<p><strong>Automatic Variables.</strong> With automatic variables we can use the names of the 
prerequisites and targets in the recipe. Here's how we would do that for the 
figure rules:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_1.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i $&lt; -o <span class="nv">$@</span>

<span class="nf">output/figure_2.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i $&lt; -o <span class="nv">$@</span>

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f output/figure_*.pdf
</pre></div>
<p>We've replaced the input and output filenames in the recipes respectively by 
<code>$&lt;</code>, which denotes the <em>first</em> prerequisite and <code>$@</code> which denotes the 
<em>target</em>. You can remember <code>$&lt;</code> because it's like an arrow that points to 
the beginning (<em>first</em> prerequisite), and you can remember <code>$@</code> (dollar 
<em>at</em>) <a href="https://jameshfisher.com/2016/12/07/makefile-automatic-variables/">as the target you're aiming 
<em>at</em></a>.</p>
<p>There are more automatic variables that you could use, see <a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">the 
documentation</a>.</p>
<p><a name="pattern_rules"></p>
<p><strong>Pattern Rules.</strong> Notice that the recipes for the figures have become 
identical!  Because we don't like to repeat ourselves, we can combine the two 
rules into a single rule by using <em>pattern rules</em>. Pattern rules allow you to 
use the <code>%</code> symbol as a wildcard and combine the two rules into one:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">output/figure_%.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i $&lt; -o <span class="nv">$@</span>

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../output/report.pdf

<span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f output/figure_*.pdf
</pre></div>
<p>The <code>%</code> symbol is now a wildcard that (in our case) takes the value <code>1</code> or 
<code>2</code> based on the input files in the <code>data</code> directory. You can check that 
everything still works by running <code>make clean</code> followed by <code>make</code>.</p>
<p>An advantage of this is that if you now want to add another dataset, say 
<code>input_file_3</code>, then you would only need to add that to the rule for the 
report!</p>
<h3 id="Makefile-no.-5-(Wildcards-and-Path-Substitution)">Makefile no. 5 (Wildcards and Path Substitution)<a class="anchor-link" href="#Makefile-no.-5-(Wildcards-and-Path-Substitution)"> </a></h3><p>When Makefiles get more complex, you may want to use more advanced features 
such as building outputs for all the files in an input directory. While 
pattern rules will get you a long way, Make also has features for wildcards 
and string or path manipulation for when pattern rules are insufficient.</p>
<p>While previously our input files were numbered, we'll now switch to a scenario 
where they have more meaningful names. Let's switch over to the <code>big_data</code> 
branch:</p>
<div class="highlight"><pre><span></span>$ git stash                     <span class="c1"># stash the state of your working directory</span>
$ git checkout big_data         <span class="c1"># checkout the big_data branch</span>
</pre></div>
<p>The directory structure now looks like this:</p>
<div class="highlight"><pre><span></span>├── data/
│   ├── action.csv
│   ├── ...
│   ├── input_file_1.csv
│   ├── input_file_2.csv
│   ├── ...
│   └── western.csv
├── LICENSE
├── output/
├── README.md
├── report/
│   └── report.tex
└── scripts/
    └── generate_histogram.py
</pre></div>
<p>As you can see, the <strong>data</strong> directory now contains additional input files 
that are named more meaningfully (the data are IMBD movie ratings by genre). 
Also, the <strong>report.tex</strong> file has been updated to work with the expected 
figures.</p>
<p>We'll adapt our Makefile to create a figure in the output directory called 
<code>histogram_{genre}.png</code> for each <code>{genre}.csv</code> file, while excluding the 
<code>input_file_{N}.csv</code> files.</p>
<blockquote><p>Sidenote: if we were to remove the <code>input_file_{N}.csv</code> files, pattern 
rules would be sufficient here. This highlights that sometimes your 
directory structure and Makefile should be developed hand in hand.</p>
</blockquote>
<p>Before changing the Makefile, run</p>
<div class="highlight"><pre><span></span>$ make clean
</pre></div>
<p>to remove the output files.</p>
<p>We'll show the full Makefile first, and then describe the different lines in 
more detail. The complete file is:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>


<span class="nv">ALL_CSV</span> <span class="o">=</span> <span class="k">$(</span>wildcard data/*.csv<span class="k">)</span>
<span class="nv">INPUT_CSV</span> <span class="o">=</span> <span class="k">$(</span>wildcard data/input_file_*.csv<span class="k">)</span>
<span class="nv">DATA</span> <span class="o">=</span> <span class="k">$(</span>filter-out <span class="k">$(</span>INPUT_CSV<span class="k">)</span>,<span class="k">$(</span>ALL_CSV<span class="k">))</span>
<span class="nv">FIGURES</span> <span class="o">=</span> <span class="k">$(</span>patsubst data/%.csv,output/figure_%.png,<span class="k">$(</span>DATA<span class="k">))</span>

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">$(FIGURES)</span><span class="o">:</span> <span class="n">output</span>/<span class="n">figure_</span>%.<span class="n">png</span>: <span class="n">data</span>/%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i $&lt; -o <span class="nv">$@</span>

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="k">$(</span><span class="nv">FIGURES</span><span class="k">)</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../<span class="nv">$@</span>

<span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f <span class="k">$(</span>FIGURES<span class="k">)</span>
</pre></div>
<p>First, we use the <code>wildcard</code> function to create a variable that lists all 
the CSV files in the data directory and one that lists only the old 
<code>input_file_{N}.csv</code> files:</p>
<div class="highlight"><pre><span></span><span class="nv">ALL_CSV</span> <span class="o">=</span> <span class="k">$(</span>wildcard data/*.csv<span class="k">)</span>
<span class="nv">INPUT_CSV</span> <span class="o">=</span> <span class="k">$(</span>wildcard data/input_file_*.csv<span class="k">)</span>
</pre></div>
<p>A code convention for Makefiles is to use all capitals for variable names and 
define them at the top of the file.</p>
<p>Next, we create a variable to list only the data files that we're interested 
in by filtering out the <code>INPUT_CSV</code> from <code>ALL_CSV</code>:</p>
<div class="highlight"><pre><span></span><span class="nv">DATA</span> <span class="o">=</span> <span class="k">$(</span>filter-out <span class="k">$(</span>INPUT_CSV<span class="k">)</span>,<span class="k">$(</span>ALL_CSV<span class="k">))</span>
</pre></div>
<p>This line uses the 
<a href="https://www.gnu.org/software/make/manual/make.html#index-filter_002dout"><code>filter-out</code></a> 
function to remove items in the <code>INPUT_CSV</code> variable from the <code>ALL_CSV</code> 
variable.  Note that we use both the <code>$( ... )</code> syntax for functions and 
variables. Finally, we'll use the <code>DATA</code> variable to create a <code>FIGURES</code> 
variable with the desired output:</p>
<div class="highlight"><pre><span></span><span class="nv">FIGURES</span> <span class="o">=</span> <span class="k">$(</span>patsubst data/%.csv,output/figure_%.png,<span class="k">$(</span>DATA<span class="k">))</span>
</pre></div>
<p>Here we've used the 
<a href="https://www.gnu.org/software/make/manual/make.html#index-patsubst-1"><code>patsubst</code></a> 
function to transform the input in the <code>DATA</code> variable (that follows the 
<code>data/{genre}.csv</code> pattern) to the desired output filenames (using the 
<code>output/figure_{genre}.png</code> pattern). Notice that the <code>%</code> character marks 
the part of the filename that will be the same in both the input and output.</p>
<p>Now we use these variables for the figure generation rule as follows:</p>
<div class="highlight"><pre><span></span><span class="nf">$(FIGURES)</span><span class="o">:</span> <span class="n">output</span>/<span class="n">figure_</span>%.<span class="n">png</span>: <span class="n">data</span>/%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i $&lt; -o <span class="nv">$@</span>
</pre></div>
<p>This rule again applies a pattern: it takes a list of targets (<code>$(FIGURES)</code>) 
that all follow a given pattern (<code>output/figure_%.png</code>) and based on that 
creates a prerequisite (<code>data/%.csv</code>). Such a pattern rule is slightly 
different from the one we saw before because it uses two <code>:</code> symbols. It is 
called a <a href="https://www.gnu.org/software/make/manual/make.html#Static-Pattern">static pattern 
rule</a>.</p>
<p>Of course we have to update the <code>report.pdf</code> rule as well:</p>
<div class="highlight"><pre><span></span><span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="k">$(</span><span class="nv">FIGURES</span><span class="k">)</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../<span class="nv">$@</span>
</pre></div>
<p>and the <code>clean</code> rule:</p>
<div class="highlight"><pre><span></span><span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f <span class="k">$(</span>FIGURES<span class="k">)</span>
</pre></div>
<p>If you run this Makefile, it will need to build 28 figures. You may want to 
use the <code>-j</code> flag to <code>make</code> to build these targets <strong>in parallel!</strong></p>
<div class="highlight"><pre><span></span>$ make -j <span class="m">4</span>
</pre></div>
<p>The ability to build targets in parallel is quite useful when your project has 
many dependencies!</p>
<p>The resulting PDF file should now look like this:</p>
<p><img src="../../figures/make/report_all_genres.png" alt="Report with all genres"><small 
style="margin: 5pt auto; text-align: center; display: block;">A compressed 
view of the report with histograms for all genres.</small></p>
<h3 id="Debugging-Makefiles">Debugging Makefiles<a class="anchor-link" href="#Debugging-Makefiles"> </a></h3><p>When writing a Makefile, it can sometimes be useful to be able to see the 
values of variables to catch mistakes or bugs in the Makefile. To facilitate 
this, Make contains two commands: <code>info</code> and <code>error</code>, and there is a debug 
mode to Make.</p>
<p>With the <code>info</code> command you can print the current value of a variable to 
stdout, while Make is processing the file. For instance, in the Makefile above 
you could add:</p>
<div class="highlight"><pre><span></span><span class="k">$(</span><span class="nv">info</span> <span class="k">$$</span><span class="nv">DATA</span> = <span class="k">$(</span><span class="nv">DATA</span><span class="k">))</span><span class="w"></span>
</pre></div>
<p>This will print <code>DATA = data/action.csv ... data/western.csv</code>.</p>
<p>With the <code>error</code> command you can stop the execution of Make at a certain 
point in the Makefile. This is useful when you want to print the value of a 
variable and not run Make any further:</p>
<div class="highlight"><pre><span></span><span class="k">$(</span><span class="nv">error</span> <span class="k">$$</span><span class="nv">DATA</span> = <span class="k">$(</span><span class="nv">DATA</span><span class="k">))</span><span class="w"></span>
</pre></div>
<p>Finally, you can also debug the Makefile by running Make with the debug flag: 
<code>make -d</code>. This will print all the rules (including built-in ones) that Make 
tries for each of the targets, and whether or not a rule needs to be run.</p>
<p>If you only want to print the rules that Make will run and not actually run 
them, you can use <code>make -n</code>. These last two options can also be combined, so 
that you see the debug output and Make doesn't run anything: <code>make -dn</code>.</p>
<h2 id="A-Real-Reproducible-Paper-using-Make">A Real Reproducible Paper using Make<a class="anchor-link" href="#A-Real-Reproducible-Paper-using-Make"> </a></h2><p>In the tutorial above we used IMDB movie ratings for different genres as 
example data. This data was obtained from a dataset <a href="https://www.kaggle.com/orgesleka/imdbmovies#imdb.csv">shared on 
Kaggle</a> as a CSV file. 
The file looks like this:</p>
<div class="highlight"><pre><span></span>fn,tid,title,wordsInTitle,url,imdbRating,ratingCount,duration,year,type,nrOfWins,nrOfNominations,nrOfPhotos,nrOfNewsArticles,nrOfUserReviews,nrOfGenre,Action,Adult,Adventure,Animation,Biography,Comedy,Crime,Documentary,Drama,Family,Fantasy,FilmNoir,GameShow,History,Horror,Music,Musical,Mystery,News,RealityTV,Romance,SciFi,Short,Sport,TalkShow,Thriller,War,Western
titles01/tt0012349,tt0012349,Der Vagabund und das Kind (1921),der vagabund und das kind,http://www.imdb.com/title/tt0012349/,8.4,40550,3240,1921,video.movie,1,0,19,96,85,3,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
titles01/tt0015864,tt0015864,Goldrausch (1925),goldrausch,http://www.imdb.com/title/tt0015864/,8.3,45319,5700,1925,video.movie,2,1,35,110,122,3,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
titles01/tt0017136,tt0017136,Metropolis (1927),metropolis,http://www.imdb.com/title/tt0017136/,8.4,81007,9180,1927,video.movie,3,4,67,428,376,2,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0
titles01/tt0017925,tt0017925,Der General (1926),der general,http://www.imdb.com/title/tt0017925/,8.3,37521,6420,1926,video.movie,1,1,53,123,219,3,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
</pre></div>
<p>While on the surface this looks like a regular CSV file, when you try to open 
it with the Python CSV library, or Pandas, or R's <code>read_csv</code>, or even 
<code>readr:read_csv</code>, the data is not loaded correctly. This happens because the 
CSV file uses an escape character <code>\</code> for movie names that have commas in 
them and the CSV readers don't automatically detect this variation in the CSV 
format.  It turns out that this is quite a common issue for data scientists: 
CSV files are often messy and use an uncommon <em>dialect</em>: such as strange delimiters and
uncommon quote characters.  Collectively, data scientists waste quite 
some time on these data wrangling issues where manual intervention is needed. 
But this problem is also not that easy to solve: to a computer a CSV file is 
simply a long string of characters and every dialect will give you <em>some</em> 
table, so how do we determine the dialect accurately in general?</p>
<p>Recently, researchers from the Alan Turing Institute have presented a method 
that achieves 97% accuracy on a large corpus of CSV files, with an improvement 
of 21% over existing approaches on non-standard CSV files. This research was 
made reproducible through the use of Make and is available through an online 
repository: 
<a href="https://github.com/alan-turing-institute/CSV_Wrangling">https://github.com/alan-turing-institute/CSV_Wrangling</a>.</p>
<p>Below we will briefly describe what the Makefile for such a project looks 
like.  For the complete file, please see the repository. The Makefile consists 
of several sections:</p>
<ol>
<li><p>Data collection: because the data is collected from public sources, the 
repository contains a Python script that allows anyone to download the data 
through a simple <code>make data</code> command.</p>
</li>
<li><p>All the figures, tables, and constants used in the paper are generated 
based on the results from the experiments. To make it easy to recreate all 
results of a certain type, <code>.PHONY</code> targets are included that depend on 
all results of that type (so you could run <code>make figures</code>). The rules for 
these outputs follow the same pattern as those for the figures in the 
tutorial above.  Tables are created as LaTeX files so they can be directly 
included in the LaTeX source for the manuscript.</p>
</li>
<li><p>The rules for the detection results follow a specific signature:</p>
<div class="highlight"><pre><span></span><span class="nf">$(OUT_DETECT)/out_sniffer_%.json</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OUT_PREPROCESS</span><span class="k">)</span>/<span class="n">all_files_</span>%.<span class="n">txt</span>
 python <span class="k">$(</span>SCRIPT_DIR<span class="k">)</span>/run_detector.py sniffer <span class="k">$(</span>DETECTOR_OPTS<span class="k">)</span> $&lt; <span class="nv">$@</span>
</pre></div>
<p>The <code>%</code> symbol is used to create outputs for both sources of CSV files 
with a single rule (see <a href="#pattern_rules">Pattern Rules</a>) and the rule uses 
<a href="#automatic_var">automatic variables</a> to extract the input and output 
filenames.</p>
</li>
<li><p>Some of the cleaning rules will remove output files that take a while to 
create.  Therefore, these depend on a special <code>check_clean</code> target that 
asks the user to confirm before proceeding:</p>
<div class="highlight"><pre><span></span><span class="nf">check_clean</span><span class="o">:</span>
 @echo -n <span class="s2">&quot;Are you sure? [y/N]&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">read</span> ans <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="nv">$$ans</span> <span class="o">==</span> y <span class="o">]</span>
</pre></div>
</li>
</ol>
<p>It is important to emphasize that this file was not created in one go, but was 
constructed iteratively. The Makefile started as a way to run several dialect 
detection methods on a collection of input files and gradually grew to include 
the creation of figures and tables from the result files. Thus the advice for 
using Make for reproducibility is to <em>start small and start early</em>.</p>
<p>The published Makefile in the repository does not contain the paper, but this 
<em>is</em> included in the internal Makefile and follows the same structure as the 
<code>report.pdf</code> file in the tutorial above. This proved especially useful for 
collaboration as only a single repository needed to be shared that contains 
the code, the results, and the manuscript.</p>
<h2 id="Further-Reading">Further Reading<a class="anchor-link" href="#Further-Reading"> </a></h2><h3 id="Manual">Manual<a class="anchor-link" href="#Manual"> </a></h3><ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html">The Official Make Reference 
manual</a>.</li>
</ul>
<h3 id="Discussions">Discussions<a class="anchor-link" href="#Discussions"> </a></h3><ul>
<li><p><a href="https://news.ycombinator.com/item?id=15041986">Discussion on Make on 
HackerNews</a>.</p>
</li>
<li><p><a href="http://aegis.sourceforge.net/auug97.pdf">Recursive Make Considered 
Harmful</a>. This is a well-known 
paper on why you shouldn't use nested makefiles. To summarise: if you do 
this Make can't see the entire DAG and that leads to problems.</p>
</li>
<li><p><a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/03/hadrian.pdf">Non-Recursive Make Considered 
Harmful</a>: 
This is a research paper describing the failings of Make for large and 
complex builds.</p>
</li>
</ul>
<h3 id="Blogs">Blogs<a class="anchor-link" href="#Blogs"> </a></h3><p>Of course we are not the first to suggest the use of Make for reproducibility! 
The blog posts cited below were found after the above tutorial was written, 
but can add further information and examples.</p>
<ul>
<li><p><a href="https://kbroman.wordpress.com/tag/reproducible-research/">Reproducibility is 
hard</a>. Discusses 
making a research project reproducible using Make.</p>
</li>
<li><p><a href="http://zmjones.com/make/">GNU Make for Reproducible Data Analysis</a>. Argues 
for using Make for reproducible analysis in a similar vein as we do above.</p>
</li>
<li><p><a href="http://byronjsmith.com/make-bml/">Reproducible Bioinformatics Pipelines using 
Make</a>. A quite extensive tutorial on using 
Make for data analysis.</p>
</li>
<li><p><a href="http://stat545.com/automation04_make-activity.html">Automatic Data-analysis 
Pipelines</a>. A similar 
tutorial that uses R for the analysis.</p>
</li>
</ul>
<h3 id="Tools">Tools<a class="anchor-link" href="#Tools"> </a></h3><ul>
<li>Plot the DAG of the Makefile with 
<a href="https://github.com/lindenb/makefile2graph">makefile2graph</a>.</li>
</ul>
<h3 id="Alternatives-to-Make">Alternatives to Make<a class="anchor-link" href="#Alternatives-to-Make"> </a></h3><p>There are <a href="https://en.wikipedia.org/wiki/List_of_build_automation_software">many alternatives to 
Make</a>. Below 
are some that caught our eye and that might be worth a look.</p>
<ul>
<li><p><a href="https://snakemake.readthedocs.io/en/stable/">SnakeMake</a>. A Python3-based 
alternative to Make. Snakemake supports multiple wildcards in filenames, 
supports Python code in rules, and can run workflows on workstations, 
clusters, the grid, and in the cloud without modification.</p>
</li>
<li><p><a href="http://gittup.org/tup/index.html">Tup</a>. A fast build system that processes 
prerequisites bottom-up instead of Make's top-down. The speed looks 
impressive and the paper describing it is interesting, but for small 
projects Make's speed will not be a bottleneck. The Tupfile syntax is not 
compatible with that of Makefiles.</p>
</li>
<li><p><a href="https://www.bazel.build">Bazel</a>. An open-source version of Google's Blaze 
build system.</p>
</li>
<li><p><a href="https://buckbuild.com/">Buck</a>. Facebook's build system.</p>
</li>
</ul>
<h2 id="Glossary">Glossary<a class="anchor-link" href="#Glossary"> </a></h2><p><strong>Makefile:</strong> a text file that contains the configuration for the build</p>
<p><strong>Rule:</strong> an element of the Makefile that defines something that must be 
built, usually consists of <em>targets</em>, <em>recipes</em>, and optionally, 
<em>prerequisites</em>.</p>
<p><strong>Target:</strong> the outcome of a <em>rule</em> in a Makefile. It is usually a file. If it 
is not a file, it's a <em>phony</em> target.</p>
<p><strong>Recipe:</strong> one or more shell commands that are executed by Make. Usually 
these commands update the <em>target</em> of the <em>rule</em>.</p>
<p><strong>Prerequisite:</strong> the prerequisite(s) of a rule correspond to files or other 
targets in the Makefile that must be up to date before the rule is run.</p>
<p><strong>Phony:</strong> a phony target is one that doesn't correspond to a file on the 
filesystem. A target is marked as phony by making it a prerequisite of the 
<code>.PHONY</code> target.</p>
<p><strong>Pattern:</strong> A pattern rule is a rule that contains exactly one <code>%</code> 
character in the target, which can be used to match a part of a filename.</p>
<h2 id="Appendix">Appendix<a class="anchor-link" href="#Appendix"> </a></h2><h3 id="Directed-Acyclic-Graph">Directed Acyclic Graph<a class="anchor-link" href="#Directed-Acyclic-Graph"> </a></h3><p>A Directed Acyclic Graph (DAG) is a <em>graph</em> of nodes and edges that is:</p>
<ol>
<li><em>directed</em>: edges have a direction and you can only walk the graph in that 
direction</li>
<li><em>acyclic</em>: does not contain cycles: A can't depend on B when B depends on A.</li>
</ol>
<p>The latter property is of course quite handy for a build system. More 
information on DAGs can be found on 
<a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">Wikipedia</a>.</p>
<h3 id="Installing-Make">Installing Make<a class="anchor-link" href="#Installing-Make"> </a></h3><p>First, check if you have GNU Make installed already. In a terminal type:</p>
<div class="highlight"><pre><span></span>$ make
</pre></div>
<p>If you get <code>make: command not found</code> (or similar), you don't have Make. If 
you get <code>make: *** No targets specified and no makefile found.  Stop.</code> you 
do have Make.</p>
<p>We'll be using <strong>GNU Make</strong> in this tutorial. Verify that this is what you 
have by typing:</p>
<div class="highlight"><pre><span></span>$ make --version
</pre></div>
<p>If you don't have GNU Make but have the BSD version, some things might not 
work as expected and we recommend installing GNU Make.</p>
<p>To install GNU Make, please follow these instructions:</p>
<ul>
<li><p><strong>Linux</strong>: Use your package manager to install Make. For instance on Arch 
Linux:</p>
<div class="highlight"><pre><span></span>$ sudo pacman -S make
</pre></div>
<p>Ubuntu:</p>
<div class="highlight"><pre><span></span>$ sudo apt-get install build-essential
</pre></div>
</li>
<li><p><strong>MacOS</strong>: If you have <a href="https://brew.sh/">Homebrew</a> installed, it's simply:</p>
<div class="highlight"><pre><span></span>$ brew install make
</pre></div>
<p>If you have a builtin Make implementation, please ensure that it's GNU Make 
by checking <code>make --version</code>.</p>
</li>
</ul>
<h3 id="Advanced:-Generating-Rules-using-Call">Advanced: Generating Rules using Call<a class="anchor-link" href="#Advanced:-Generating-Rules-using-Call"> </a></h3><p><em>This section continues the tutorial above and demonstrates a feature of Make 
for automatic generation of rules.</em></p>
<p>In a data science pipeline, it may be quite common to apply multiple scripts 
to the same data (for instance when you're comparing methods or testing 
different parameters). In that case, it can become tedious to write a separate 
rule for each script when only the script name changes. To simplify this 
process, we can let Make expand a so-called <a href="https://www.gnu.org/software/make/manual/make.html#Canned-Recipes"><em>canned</em> 
recipe</a>.</p>
<p>To follow along, switch to the <code>canned</code> branch:</p>
<div class="highlight"><pre><span></span>$ make clean
$ git stash --all        <span class="c1"># note the &#39;--all&#39; flag so we also stash the Makefile</span>
$ git checkout canned
</pre></div>
<p>On this branch you'll notice that there is a new script in the <strong>scripts</strong> 
directory called <code>generate_qqplot.py</code>. This script works similarly to the 
<code>generate_histogram.py</code> script (it has the same command line syntax), but it 
generates a <a href="https://en.wikipedia.org/wiki/Q%E2%80%93Q_plot">QQ-plot</a>. The 
<strong>report.tex</strong> file has also been updated to incorporate these plots.</p>
<p>After switching to the <code>canned</code> branch there will be a Makefile in the 
repository that contains a separate rule for generating the QQ-plots. This 
Makefile looks like this:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>


<span class="nv">ALL_CSV</span> <span class="o">=</span> <span class="k">$(</span>wildcard data/*.csv<span class="k">)</span>
<span class="nv">DATA</span> <span class="o">=</span> <span class="k">$(</span>filter-out <span class="k">$(</span>wildcard data/input_file_*.csv<span class="k">)</span>,<span class="k">$(</span>ALL_CSV<span class="k">))</span>
<span class="nv">HISTOGRAMS</span> <span class="o">=</span> <span class="k">$(</span>patsubst data/%.csv,output/figure_%.png,<span class="k">$(</span>DATA<span class="k">))</span>
<span class="nv">QQPLOTS</span> <span class="o">=</span> <span class="k">$(</span>patsubst data/%.csv,output/qqplot_%.png,<span class="k">$(</span>DATA<span class="k">))</span>

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="nf">$(HISTOGRAMS)</span><span class="o">:</span> <span class="n">output</span>/<span class="n">histogram_</span>%.<span class="n">png</span>: <span class="n">data</span>/%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
    python scripts/generate_histogram.py -i $&lt; -o <span class="nv">$@</span>

<span class="nf">$(QQPLOTS)</span><span class="o">:</span> <span class="n">output</span>/<span class="n">qqplot_</span>%.<span class="n">png</span>: <span class="n">data</span>/%.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_qqplot</span>.<span class="n">py</span>
    python scripts/generate_qqplot.py -i $&lt; -o <span class="nv">$@</span>

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="k">$(</span><span class="nv">FIGURES</span><span class="k">)</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../<span class="nv">$@</span>

<span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f <span class="k">$(</span>HISTOGRAMS<span class="k">)</span> <span class="k">$(</span>QQPLOTS<span class="k">)</span>
</pre></div>
<p>You'll notice that the rules for histograms and QQ-plots are very similar.</p>
<p>As the number of scripts that you want to run on your data grows, this may 
lead to a large number of rules in the Makefile that are almost exactly the 
same. We can simplify this by creating a <a href="https://www.gnu.org/software/make/manual/html_node/Canned-Recipes.html"><em>canned 
recipe</em></a> 
that takes both the name of the script and the name of the genre as input:</p>
<div class="highlight"><pre><span></span><span class="cp">define run-script-on-data</span>
<span class="nf">output/$(1)_$(2).png</span><span class="o">:</span> <span class="n">data</span>/<span class="k">$(</span><span class="nv">2</span><span class="k">)</span>.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_</span><span class="k">$(</span><span class="nv">1</span><span class="k">)</span>.<span class="n">py</span>
    python scripts/generate_<span class="k">$(</span><span class="m">1</span><span class="k">)</span>.py -i <span class="nv">$$</span>&lt; -o <span class="nv">$$</span>@
<span class="cp">endef</span>
</pre></div>
<p>Note that in this recipe we use <code>$(1)</code> for either <code>histogram</code> or 
<code>qqplot</code> and <code>$(2)</code> for the genre. These correspond to the expected 
function arguments to the <code>run-script-on-data</code> canned recipe. Also, notice 
that we use <code>$$&lt;</code> and <code>$$@</code> in the actual recipe, with two <code>$</code> symbols 
for escaping. To actually create all the targets, we need a line that calls 
this canned recipe.  In our case, we use a double for loop over the genres and 
the scripts:</p>
<div class="highlight"><pre><span></span><span class="k">$(</span><span class="nv">foreach</span> <span class="nv">genre</span>,<span class="k">$(</span><span class="nv">GENRES</span><span class="k">)</span>,\
    <span class="k">$(</span><span class="nv">foreach</span> <span class="nv">script</span>,<span class="k">$(</span><span class="nv">SCRIPTS</span><span class="k">)</span>,\
        <span class="k">$(</span><span class="nv">eval</span> <span class="k">$(</span><span class="nv">call</span> <span class="nv">run-script-on-data</span>,<span class="k">$(</span><span class="nv">script</span><span class="k">)</span>,<span class="k">$(</span><span class="nv">genre</span><span class="k">)))</span> \
    <span class="k">)</span> \
<span class="k">)</span><span class="w"></span>
</pre></div>
<p>In these lines the <code>\</code> character is used for continuing long lines.</p>
<p>The full Makefile then becomes:</p>
<div class="highlight"><pre><span></span><span class="c"># Makefile for analysis report</span>


<span class="nv">ALL_CSV</span> <span class="o">=</span> <span class="k">$(</span>wildcard data/*.csv<span class="k">)</span>
<span class="nv">DATA</span> <span class="o">=</span> <span class="k">$(</span>filter-out <span class="k">$(</span>wildcard data/input_file_*.csv<span class="k">)</span>,<span class="k">$(</span>ALL_CSV<span class="k">))</span>
<span class="nv">HISTOGRAMS</span> <span class="o">=</span> <span class="k">$(</span>patsubst %,output/histogram_%.png,<span class="k">$(</span>GENRES<span class="k">))</span>
<span class="nv">QQPLOTS</span> <span class="o">=</span> <span class="k">$(</span>patsubst %,output/qqplot_%.png,<span class="k">$(</span>GENRES<span class="k">))</span>

<span class="nv">GENRES</span> <span class="o">=</span> <span class="k">$(</span>patsubst data/%.csv,%,<span class="k">$(</span>DATA<span class="k">))</span>
<span class="nv">SCRIPTS</span> <span class="o">=</span> histogram qqplot

<span class="nf">.PHONY</span><span class="o">:</span> <span class="n">all</span> <span class="n">clean</span>

<span class="nf">all</span><span class="o">:</span> <span class="n">output</span>/<span class="n">report</span>.<span class="n">pdf</span>

<span class="cp">define run-script-on-data</span>
<span class="nf">output/$(1)_$(2).png</span><span class="o">:</span> <span class="n">data</span>/<span class="k">$(</span><span class="nv">2</span><span class="k">)</span>.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_</span><span class="k">$(</span><span class="nv">1</span><span class="k">)</span>.<span class="n">py</span>
    python scripts/generate_<span class="k">$(</span><span class="m">1</span><span class="k">)</span>.py -i <span class="nv">$$</span>&lt; -o <span class="nv">$$</span>@
<span class="cp">endef</span>

<span class="k">$(</span><span class="nv">foreach</span> <span class="nv">genre</span>,<span class="k">$(</span><span class="nv">GENRES</span><span class="k">)</span>,\
    <span class="k">$(</span><span class="nv">foreach</span> <span class="nv">script</span>,<span class="k">$(</span><span class="nv">SCRIPTS</span><span class="k">)</span>,\
        <span class="k">$(</span><span class="nv">eval</span> <span class="k">$(</span><span class="nv">call</span> <span class="nv">run-script-on-data</span>,<span class="k">$(</span><span class="nv">script</span><span class="k">)</span>,<span class="k">$(</span><span class="nv">genre</span><span class="k">)))</span>\
    <span class="k">)</span>\
<span class="k">)</span><span class="w"></span>

<span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="k">$(</span><span class="nv">HISTOGRAMS</span><span class="k">)</span> <span class="k">$(</span><span class="nv">QQPLOTS</span><span class="k">)</span>
    <span class="nb">cd</span> report/ <span class="o">&amp;&amp;</span> pdflatex report.tex <span class="o">&amp;&amp;</span> mv report.pdf ../<span class="nv">$@</span>

<span class="nf">clean</span><span class="o">:</span>
    rm -f output/report.pdf
    rm -f <span class="k">$(</span>HISTOGRAMS<span class="k">)</span> <span class="k">$(</span>QQPLOTS<span class="k">)</span>
</pre></div>
<p>Note that we've added a <code>SCRIPTS</code> variable with the <code>histogram</code> and 
<code>qqplot</code> names. If we were to add another script that follows the same 
pattern as these two, we would only need to add it to the <code>SCRIPTS</code> 
variable.</p>
<p>To build all of this, run</p>
<div class="highlight"><pre><span></span>$ make -j <span class="m">4</span>
</pre></div>

</div>
</div>
</div>
</div>

 


    </main>
    
            </div>
            <div class="c-textbook__footer" id="textbook_footer">
              
<nav class="c-page__nav">
  
    
    

    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/es/continuous_integration/continuous_integration.html">
      〈 <span class="u-margin-right-tiny"></span> Continuous Integration
    </a>
  

  
    

    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/es/risk_assessment/risk_assessment.html">
      Risk Assessment <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

              <footer>
  <p class="footer">This page was created by <a href="https://github.com/alan-turing-institute/the-turing-way#contributors">The Turing Way Community</a></p>
</footer>

            </div>

        </div>
      </main>
    </div>
  </body>
</html>
